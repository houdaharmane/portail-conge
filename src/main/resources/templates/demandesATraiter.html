<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Demandes à traiter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <style>
    :root {
      --sidebar-bg: #0074C7;
      --link-color: #fff;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      min-height: 100vh;
      background-color: var(--bg-color);
      color: var(--text-color);
    }

    body {
      --bg-color: #f6f6f6;
      --text-color: #000;
    }

    .dark-theme {
      --bg-color: #1e1e1e;
      --text-color: #f0f0f0;
    }

    .sidebar {
      width: 240px;
      background-color: var(--sidebar-bg);
      color: var(--link-color);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 100vh;
    }

    .sidebar-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 32px 0 18px 0;
    }

    .sidebar-logo {
      width: 90px;
      height: 90px;
      border-radius: 50%;
      background: #fff;
      object-fit: cover;
      margin-bottom: 10px;
    }

    .dark-theme .sidebar-logo {
      background: #2a2a2a;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 14px;
      text-decoration: none;
      color: var(--link-color);
      font-size: 16px;
      font-weight: 600;
      padding: 13px 30px;
      transition: background 0.18s;
    }

    .sidebar-link:hover,
    .sidebar-link.active {
      background: rgba(255,255,255,0.2);
    }

    .sidebar-link i {
      font-size: 20px;
      min-width: 20px;
    }

    .sidebar-footer {
      margin-bottom: 30px;
    }

    .main-content {
      flex: 1;
      padding: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
      overflow-x: auto;
    }
  .header {
            height: 60px;
            background-color: var(--header-bg);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding: 0 20px;
            border-bottom: 1px solid #ccc;
            box-shadow: 0 2px 8px #e9953d11;
            
        }
        .header a {
            text-decoration: none;
            color:  #0074C7;
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 17px;
        }
        .header a i {
            margin-right: 8px;
            font-size: 24px;
        }
        .theme-toggle-btn {
            background: none;
            border: none;
            font-size: 20px;
            color: #0074C7;
            cursor: pointer;
        }

        .dark-theme .theme-toggle-btn {
            color: #f0f0f0;
        }


.dark-theme .header a {
  color: #66aaff;
}

.dark-theme .theme-toggle-btn {
  color: #f0f0f0;
}

    .theme-toggle-btn {
      background: none;
      border: none;
      font-size: 20px;
      color: var(--text-color);
      cursor: pointer;
      transition: color 0.3s ease;
    }

    .theme-toggle-btn i {
      pointer-events: none;
    }

    .request-list {
      flex: 1;
      overflow-y: auto;
    }

    .request-item {
      background: rgba(255, 255, 255, 0.1);
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s;
      font-size: 14px;
    }

    .request-item:hover {
      background-color: rgba(255,255,255,0.3);
    }

    .request-item.active {
      background-color: white;
      color: #0074C7;
      font-weight: bold;
    }

    .details-panel {
      flex: 1;
      background: white;
      padding: 20px;
      overflow-y: auto;
      box-shadow: -3px 0 10px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }

    .details-header {
      font-size: 24px;
      margin-bottom: 15px;
      border-bottom: 2px solid #0074C7;
      padding-bottom: 8px;
    }

    .details-content {
      flex: 1;
      font-size: 16px;
      line-height: 1.5;
    }

    .actions {
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    .actions a {
      padding: 10px 20px;
      border-radius: 5px;
      text-decoration: none;
      font-weight: bold;
      color: white;
      cursor: pointer;
      user-select: none;
      text-align: center;
      flex: 1;
    }

    .actions a.approve {
      background-color: #28a745;
    }
    .actions a.reject {
      background-color: #dc3545;
    }

    .actions a:hover {
      opacity: 0.85;
    }

    /* Scrollbar stylé (optionnel) */
    .request-list::-webkit-scrollbar {
      width: 6px;
    }
    .request-list::-webkit-scrollbar-thumb {
      background-color: rgba(0,0,0,0.2);
      border-radius: 3px;
    }
    .details-panel {
  flex: 1;
  background: var(--bg-color);
  color: var(--text-color);
  padding: 20px;
  overflow-y: auto;
  box-shadow: -3px 0 10px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
}

.details-header {
  font-size: 24px;
  margin-bottom: 15px;
  border-bottom: 2px solid #0074C7;
  padding-bottom: 8px;
}

.dark-theme .details-header {
  border-color: #66aaff;
}

.actions a.approve {
  background-color: #28a745;
  color: white;
}

.actions a.reject {
  background-color: #dc3545;
  color: white;
}

.dark-theme .actions a.approve {
  background-color: #19692c;
}

.dark-theme .actions a.reject {
  background-color: #7a1d22;
}

  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div>
      <div class="sidebar-header">
        <img src="/img/modepbg.png" alt="Logo MODEP" class="sidebar-logo" />
      </div>
    <nav>
    <a th:href="@{/dashboard-responsable}" th:classappend="${activePage == 'dashboard'} ? ' active'" class="sidebar-link">
        <i class="fa fa-home"></i> <span>Tableau de bord</span>
    </a>
 <a th:href="@{/demandes-a-traiter}" th:classappend="${activePage == 'demandesATraiter'} ? ' active'" class="sidebar-link">
  <i class="fa fa-wallet"></i> <span>Demandes à traiter</span>
</a>
<a th:href="@{/responsable/conge/demande}" th:classappend="${activePage == 'demandeConge'} ? ' active'" class="sidebar-link">
    <i class="fa fa-plane-departure"></i> <span>Demande de congé</span>
</a>

    <a th:href="@{/profil-responsable}" th:classappend="${activePage == 'profil'} ? ' active'" class="sidebar-link">
        <i class="fa fa-user"></i> <span>Mon profil</span>
    </a>
<a th:href="@{/responsable/historique-demandes-personnel}" th:classappend="${activePage == 'historiqueDemandesPersonnel'} ? ' active'" class="sidebar-link">
    <i class="fa fa-history"></i> <span>Historique du personnel</span>
</a>

<a th:href="@{/responsable/historique-demandes-responsable}" th:classappend="${activePage == 'historiqueDemandesResponsable'} ? ' active'" class="sidebar-link">
    <i class="fa fa-history"></i> <span>Historique du responsable</span>
</a>


</nav>
    </div>
    <div class="sidebar-footer">
        <a href="/login" class="sidebar-link"><i class="fa fa-sign-out-alt"></i> <span>Déconnexion</span></a>
    </div>
  </div>

  <!-- Main content -->
  <div class="main-content">
    <div class="header">
      <button id="theme-toggle" class="theme-toggle-btn" title="Changer de thème">
        <i class="fa fa-moon"></i>
      </button>
    </div>
    <h2></h2>
<div style="display: flex; gap: 20px; height: 500px;">
  <div class="request-list" id="requestList" style="flex: 1; overflow-y: auto;">
    <div 
      th:each="demande : ${demandes}" 
      th:id="'demande-'+${demande.id}" 
      class="request-item"
      th:data-id="${demande.id}"
      th:data-nom="${demande.demandeur.nom}"
      th:data-date-debut="${#temporals.format(demande.dateDebut, 'dd/MM/yyyy')}"
      th:data-date-fin="${demande.dateFin != null ? #temporals.format(demande.dateFin, 'dd/MM/yyyy') : 'N/A'}"
      th:data-statut="${demande.statut}"
      onclick="selectRequest(this)">
      
      <strong th:text="${demande.demandeur.nom}">Nom</strong>
      <br/>
      <small th:text="|Du ${#temporals.format(demande.dateDebut, 'dd/MM/yyyy')} au ${demande.dateFin != null ? #temporals.format(demande.dateFin, 'dd/MM/yyyy') : '...'}|">
        Dates
      </small>
    </div>
    <div th:if="${#lists.isEmpty(demandes)}" style="color: white; text-align: center; margin-top: 20px;">
      Aucune demande à traiter
    </div>
  </div>

  <div class="details-panel" id="detailsPanel" style="flex: 1; overflow-y: auto;">
    <div class="details-header" id="detailsHeader">
      Veuillez sélectionner une demande
    </div>
    <div class="details-content" id="detailsContent">
      Les détails s'afficheront ici...
    </div>
    <div class="actions" id="actionsContainer" style="display:none;">
      <a href="#" id="btnApprove" class="approve">Approuver</a>
      <a href="#" id="btnReject" class="reject">Rejeter</a>
    </div>
  </div>
</div>

  <script>

const themeToggleBtn = document.getElementById('theme-toggle');
const icon = themeToggleBtn.querySelector('i');

function applyTheme(theme) {
  if (theme === 'dark') {
    document.body.classList.add('dark-theme');
    icon.classList.remove('fa-moon');
    icon.classList.add('fa-sun');
  } else {
    document.body.classList.remove('dark-theme');
    icon.classList.remove('fa-sun');
    icon.classList.add('fa-moon');
  }
}

window.addEventListener('DOMContentLoaded', () => {
  const savedTheme = localStorage.getItem('theme') || 'light';
  applyTheme(savedTheme);
});

themeToggleBtn.addEventListener('click', () => {
  const isDark = document.body.classList.toggle('dark-theme');
  applyTheme(isDark ? 'dark' : 'light');
  localStorage.setItem('theme', isDark ? 'dark' : 'light');
});

    const requestList = document.getElementById('requestList');
    const detailsHeader = document.getElementById('detailsHeader');
    const detailsContent = document.getElementById('detailsContent');
    const actionsContainer = document.getElementById('actionsContainer');
    const btnApprove = document.getElementById('btnApprove');
    const btnReject = document.getElementById('btnReject');

    let currentSelected = null;

    function selectRequest(elem) {
      if(currentSelected) {
        currentSelected.classList.remove('active');
      }
      elem.classList.add('active');
      currentSelected = elem;

      const demandeId = elem.getAttribute('data-id');
      const nom = elem.getAttribute('data-nom');
      const dateDebut = elem.getAttribute('data-date-debut');
      const dateFin = elem.getAttribute('data-date-fin');
      const statut = elem.getAttribute('data-statut');

      detailsHeader.textContent = "Demande de " + nom;
      detailsContent.innerHTML = `
        <p><strong>Date de début:</strong> ${dateDebut}</p>
        <p><strong>Date de fin:</strong> ${dateFin}</p>
        <p><strong>Statut:</strong> ${statut}</p>
      `;
      actionsContainer.style.display = "flex";

      btnApprove.href = '/approuver/' + demandeId;
      btnReject.href = '/rejeter/' + demandeId;
    }

    window.onload = function() {
      const firstRequest = requestList.querySelector('.request-item');
      if(firstRequest) selectRequest(firstRequest);
    }
  </script>
</body>
</html>